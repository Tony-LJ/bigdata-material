
# Impala-Sql调优整理

---

## JOIN优化
### 利用STRAIGHT_JOIN 覆盖 Join 重新排序
```.text
如果 Impala 合并查询由于统计信息过期或意外数据分发而效率低下，您可以在使用 STRAIGHT_JOIN 关键字前先立即使用 SELECT 关键字从而让 Impala 避免对合并表重新排序。
STRAIGHT_JOIN 关键词将关闭 Impala 内部执行的合并子句重新排序操作，并生成依赖于在查询文本中以最佳方式进行排序的合并子句的计划。
/* +BROADCAST */ 和 /* +SHUFFLE */ 提示可控制合并查询的执行策略。在查询的 JOIN 关键词后面指定以下其中一种结构：
1. /* +SHUFFLE */   - 让合并操作使用"分区"技术，该技术可使用用散列算法分割这两个表格中对应的行，并将行的子集发送给其他行以进行处理。（关键字 用于表示"已分区合并"，由于这种类型的合并与"已分区表"不相关。）由于当表和索引统计信息不可用时可替代"广播"合并机制为默认选项，您可能在广播合并不适用的情况下使用该查询提示；通常，已分区的合并对大小相似的较大表之间的合并更为有效。
2. /* +BROADCAST */ - 让使用"广播"技术的合并操作，该操作指将右侧表中的所有内容发送到处理合并时涉及的所有节点。当表和索引统计信息不可用时，这是默认操作模式，因此通常只有过时的元数据导致 Impala 错误地选择分区合并操作时您才用得到。通常情况下，当一个表格比另一个表格小得多的情况下，广播合并才更为高效。（将较小的表放在 运算符的右侧。）
```



